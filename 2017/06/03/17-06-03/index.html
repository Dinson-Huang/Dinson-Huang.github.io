<!doctype html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta content="telephone=no" name="format-detection">
  <meta name="keywords" content="Android,设计模式,安卓入门,安卓高级,前端,JavaScript,h5,css3,Jquery">
  <meta name="description" content="null">
  <meta name="author" content="DINSON">
 
 
<meta name="keywords" content="Android自定义View ViewPager,Android,设计模式,安卓入门,安卓高级,前端,JavaScript,h5,css3,Jquery">


  
  <title>ViewPager系列--打造一个通用的ViewPager</title>
  

  <link rel="alternate" href="/atom.xml" title="Android - Dinson - 酸奶布丁 - 国家一级码农" type="application/atom+xml">
  <link rel="canonical" href="http://dinson.win/2017/06/03/17-06-03/index.html">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_8ce77jkwodt5ipb9.css">
</head>


  <body>
    <aside class="aside">
  <nav class="aside-menu">
    <ul class="aside-list">
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-home"></i><a href="/index.html" class="aside-menu-link" title="酸奶布丁">酸奶布丁</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-all"></i><a href="/archives/index.html" class="aside-menu-link" title="时间印记">时间印记</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-tag"></i><a href="/tags/index.html" class="aside-menu-link" title="分类标记">分类标记</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-python"></i><a href="http://dinson.win/Python/index.html" class="aside-menu-link" title="Python">Python</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-jinglingqiu"></i><a href="http://dinson.win/Pokemon/" class="aside-menu-link" title="口袋妖怪">口袋妖怪</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-me"></i><a href="/about/index.html" class="aside-menu-link" title="关于">关于</a></li>
        
      
        
        <li class="aside-item"><i class="aside-menu-icon iconfont icon-rss"></i><a href="/atom.xml" class="aside-menu-link" title="RSS">RSS</a></li>
        
      
    </ul>
  </nav>

  <article class="aside-show">
    
      <form class="search-from" id="search-from">
  <input class="search-text" id="search-text" type="text" name="searchText" value="" autocomplete="off">
  <button class="search-btn" id="search-btn" type="button"><i class="search-btn-icon iconfont icon-sousuo-sousuo"></i></button>
</form>

      <article class="search-data" id="search-data">
  <button class="search-close" id="search-close"><i class="search-close-icon iconfont icon-quxiao"></i></button>

  <div class="search-wrapper" id="search-wrapper"></div>
</article>

    
    <div class="aside-show-wrapper">
      <figure class="aside-avatar">
        <img src="/img/avatar.jpg" alt="avatar" class="aside-avatar-img">
        <figcaption class="aside-avatar-caption">
          Dinson
          
          <strong class="aside-avatar-STRONG">Android喵</strong>
          
        </figcaption>
      </figure>
      <p class="aside-show-description">面朝电脑--栀子花开</p>
      <ul class="aside-show-info" >
	  <li class="aside-show-item"><a href="https://github.com/DinsonCat" class="aside-show-link" target="_blank"><i class="aside-show-icon iconfont icon-github"></i></a></li>
        <li class="aside-show-item">
          <a href="javascript: void(0);" class="aside-show-link"   target="_blank"><i class="aside-show-icon iconfont icon-wechat"></i></a>
          <div class="aside-show-outside aside-show-outside_1">
            <img class="aside-show-IMG aside-show-IMG_1" src="/img/weixin.png" alt="微信"  >
          </div>
        </li>
        <li class="aside-show-item">
          <a href="javascript: void(0);" class="aside-show-link"   target="_blank"><i class="aside-show-icon iconfont icon-qq"></i></a>
          <div class="aside-show-outside">
            <img class="aside-show-IMG  " src="/img/qq.jpg"   alt="QQ">
          </div>
        </li>
		 
      </ul>
	
	 
    </div>
	
  </article>
</aside>


    <article class="main" id="main">
      <article class="post min-height">
  
  <header class="post-header">
    
    <h1 class="post-title">ViewPager系列--打造一个通用的ViewPager</h1>
    <p class="post-meta">
      </span>
      
      <a href="/categories/Android嫡系/" class="post-categories">Android嫡系</a>
      
      
      <a href="/tags/ViewPager系列/"" class="post-tags"><i class="post-tags-icon iconfont icon-waixingren"></i>ViewPager系列</a>
      
	  
	  
		<span id="busuanzi_container_page_pv"  class="post-time"><i class="post-tags-icon iconfont icon-yuedu"></i>Views <span id="busuanzi_value_page_pv"></span> Times</span>
	  
	  
    </p>
    
  </header>
  <div class="post-content"><p><img src="http://ondlsj2sn.bkt.clouddn.com/Fp12BE__fI69mJ45l7jGBc-Ktk5K.png" alt=""></p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>ViewPager是Android开发者比较常用的一个控件了，由于它允许数据页从左到右或者从右到左翻页，因此这种交互也备受设计师的青睐。在APP中的很多场景都用得到，比如第一次安装APP时的用户引导页、图片浏览时左右翻页、广告Banner页等等都会用到ViewPager。ViewPager 的使用和RecyclerView的使用方式很相似，熟悉RecyclerView的朋友都知道，我们要使用RecyclerView，就得给RecyclerView提供一个Adapter来提供布局和装载数据。但是有一个比较麻烦的事情是，我们每次使用RecyclerView都要给他提供一个Adapter,并且这些Adapter中的一些方法和代码都是相同的，这使得我们写了很多重复的代码，降低了我们的开发效率，因此github有各种个样的对RecyclerView 的再度封装，目的就是减少这些重复的代码，尽量代码复用，使开发更简单。那么ViewPager的使用和RecyclerView 是非常相似的，我们同样也是给ViewPager提供一个Adapter来提供布局和装载数据。写Adapter的时候同样会写很多重复代码，那么我们是否能像RecyclerView一样，也对Viewpager来做一个再次封装，达到复用和简单的效果呢？答案是肯定的，因此这篇文章就一起来封装一个通用的ViewPager。</p>
</blockquote>
<a id="more"></a>
<!-- 这是　　缩进-->
<h2 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h2><p>看过一些技术博客，对于普通的ViewPager使用封装的比较少，大多数的封装只是在用作Banner 的时候，也就是ViewPager 每页只显示一张图片。对外提供一个接口，传递一个imageUrl 数组就直接展示，不用再写其他的Adapter之类的。但是这样封装其实还是有一些局限性的。</p>
<ol>
<li>每个项目用的图片加载框架是不一样的，Picasso、Glide、ImageLoader等等各不相同，那么我们还需要在显示图片的时候换成自己用的图片加载框架才行。</li>
<li>并不是所有的Banner 都只是显示一张图片,还有各种个样的文案展示等等，因此不能个性化定制，这是比较致命的。</li>
</ol>
<blockquote>
<p>看看上面的局限性，是什么造成了这些局限性呢？<strong>答案是我们没有主动权，主动权在Adapter手中，他控制了布局，控制了数据绑定，所以它说怎样展示就怎样展示，它说展示什么就展示什么。</strong>那么现在问题的关键来了，我们又不想写Adapter,又想按照我们的指示展示布局和数据，怎么办呢？那就要从Adapter中夺回主动权，我们想ViewPager展示成什么样子我们自己说了算。Adapter只需要把我们提供给他的东西按照我们的指示展示就行了。具体的布局和数据绑定都我们自己控制。因此，<strong>有了主动权，展示什么布局我们能控制，用什么框架加载图片我们同样能控制。用什么方式来告诉Adapter 做页面展示呢？就用万能的接口啦。</strong></p>
</blockquote>
<h2 id="封装通用的ViewPager"><a href="#封装通用的ViewPager" class="headerlink" title="封装通用的ViewPager"></a>封装通用的ViewPager</h2><p>通过上面现状的分析，我们知道了，要封装一个比较通用的ViewPager,首先就是要从Adapter那里夺回主动权，因为它控制了布局和数据绑定。有了主动权之后，我们提供布局给Adapter，然后我们自己控制数据绑定。其中有2个关键的点：<strong>1，提供布局 。 2，数据绑定。</strong> 看到这两个点是不是觉得很熟悉？当然很熟悉，这不就是<code>RecyclerView</code>的<code>ViewHolder</code>干的事情嘛。既然是这样我们就借鉴一下 RecyclerView的ViewHolder呗。</p>
<h3 id="第一步：定义一个ViewHolder接口来提供布局和绑定数据：ViewPagerHolder代码如下："><a href="#第一步：定义一个ViewHolder接口来提供布局和绑定数据：ViewPagerHolder代码如下：" class="headerlink" title="第一步：定义一个ViewHolder接口来提供布局和绑定数据：ViewPagerHolder代码如下："></a>第一步：定义一个ViewHolder接口来提供布局和绑定数据：ViewPagerHolder代码如下：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ViewPagerHolder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     *  创建View</div><div class="line">     * <span class="doctag">@param</span> context</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function">View <span class="title">createView</span><span class="params">(Context context)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 绑定数据</div><div class="line">     * <span class="doctag">@param</span> context</div><div class="line">     * <span class="doctag">@param</span> position</div><div class="line">     * <span class="doctag">@param</span> data</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onBind</span><span class="params">(Context context,<span class="keyword">int</span> position,T data)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>ViewPagerHolder</code>接收一个泛型T,这是绑定数据要用的实体类。其中有2个方法，一个提供给Adapter布局，另一个则用于绑定数据。</p>
<h3 id="第二步：-创建一个ViewHolder生成器，用来生成各种ViewHolder"><a href="#第二步：-创建一个ViewHolder生成器，用来生成各种ViewHolder" class="headerlink" title="第二步： 创建一个ViewHolder生成器，用来生成各种ViewHolder:"></a>第二步： 创建一个ViewHolder生成器，用来生成各种ViewHolder:</h3><p><code>ViewPagerHolderCreator</code> 代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ViewPagerHolderCreator</span>&lt;<span class="title">VH</span> <span class="keyword">extends</span> <span class="title">ViewPagerHolder</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 创建ViewHolder</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> VH <span class="title">createViewHolder</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该类接受一个 泛型，但是必须得是ViewPagerHolder 的子类，一个方法createViewHolder，返回ViewHolder实例。</p>
<h3 id="第三步：-重写-ViewPager-的Adapter："><a href="#第三步：-重写-ViewPager-的Adapter：" class="headerlink" title="第三步： 重写 ViewPager 的Adapter："></a>第三步： 重写 ViewPager 的Adapter：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonViewPagerAdapter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">PagerAdapter</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;T&gt; mDatas;</div><div class="line">    <span class="keyword">private</span> ViewPagerHolderCreator mCreator;<span class="comment">//ViewHolder生成器</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonViewPagerAdapter</span><span class="params">(List&lt;T&gt; datas, ViewPagerHolderCreator creator)</span> </span>&#123;</div><div class="line">        mDatas = datas;</div><div class="line">        mCreator = creator;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDatas == <span class="keyword">null</span> ? <span class="number">0</span>:mDatas.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isViewFromObject</span><span class="params">(View view, Object object)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> view == object;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">instantiateItem</span><span class="params">(ViewGroup container, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="comment">//重点就在这儿了，不再是把布局写死，而是用接口提供的布局</span></div><div class="line">        <span class="comment">// 也不在这里绑定数据，数据绑定交给Api调用者。</span></div><div class="line">        View view = getView(position,<span class="keyword">null</span>,container);</div><div class="line">        container.addView(view);</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroyItem</span><span class="params">(ViewGroup container, <span class="keyword">int</span> position, Object object)</span> </span>&#123;</div><div class="line">        container.removeView((View) object);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取viewPager 页面展示View</div><div class="line">     * <span class="doctag">@param</span> position</div><div class="line">     * <span class="doctag">@param</span> view</div><div class="line">     * <span class="doctag">@param</span> container</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position,View view ,ViewGroup container)</span></span>&#123;</div><div class="line"></div><div class="line">        ViewPagerHolder holder =<span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span>(view == <span class="keyword">null</span>)&#123;</div><div class="line">            <span class="comment">//创建Holder</span></div><div class="line">            holder = mCreator.createViewHolder();</div><div class="line">            view = holder.createView(container.getContext());</div><div class="line">            view.setTag(R.id.common_view_pager_item_tag,holder);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            holder = (ViewPagerHolder) view.getTag(R.id.common_view_pager_item_tag);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>(holder!=<span class="keyword">null</span> &amp;&amp; mDatas!=<span class="keyword">null</span> &amp;&amp; mDatas.size()&gt;<span class="number">0</span>)&#123;</div><div class="line">            <span class="comment">// 数据绑定</span></div><div class="line">            holder.onBind(container.getContext(),position,mDatas.get(position));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>这个类比较重要，因为以前我们的布局提供和数据绑定都是在Adapter中的，因此现在我们就将这两项工作交给我们的ViewHolder。CommonViewPagerAdapter 的构造方法需要展示的数据集合和ViewPagerHolderCreator 生成器。其他代码都有注释一看便明白。</p>
</blockquote>
<h3 id="第四部：包装ViewPager"><a href="#第四部：包装ViewPager" class="headerlink" title="第四部：包装ViewPager"></a>第四部：包装ViewPager</h3><p>Adapter和ViewHolder都有了，现在我们只需要一个ViewPager 就大功告成了。我们采用自定义View 组合的方式来写这个ViewPager.<br>1 . 提供ViewPager 布局：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">                <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">                <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">     <span class="comment">&lt;!-- ViewPager--&gt;</span></div><div class="line"></div><div class="line">     <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></div><div class="line">         <span class="attr">android:id</span>=<span class="string">"@+id/common_view_pager"</span></div><div class="line">         <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">         <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</div><div class="line"></div><div class="line">     <span class="comment">&lt;!-- 指示器 indicatorView--&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">com.zhouwei.indicatorview.CircleIndicatorView</span></span></div><div class="line">         <span class="attr">android:id</span>=<span class="string">"@+id/common_view_pager_indicator_view"</span></div><div class="line">         <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">         <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">         <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></div><div class="line">         <span class="attr">android:layout_marginBottom</span>=<span class="string">"10dp"</span></div><div class="line">         <span class="attr">app:indicatorSelectColor</span>=<span class="string">"@android:color/white"</span></div><div class="line">         <span class="attr">app:indicatorColor</span>=<span class="string">"@android:color/darker_gray"</span></div><div class="line">         <span class="attr">app:fill_mode</span>=<span class="string">"none"</span></div><div class="line">         <span class="attr">app:indicatorSpace</span>=<span class="string">"5dp"</span></div><div class="line">         <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>布局中一个ViewPager 和一个指示器View, IndicatorView 用的是前面分享的CircleIndicatorView 。博客地址：<a href="http://dinson.win/2017/06/02/17-06-02/">ViewPager系列–实现一个多功能的IndicatorView</a>。</p>
<p>2 . CommonViewPager ，代码如下：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonViewPager</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">RelativeLayout</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> ViewPager mViewPager;</div><div class="line">    <span class="keyword">private</span> CommonViewPagerAdapter mAdapter;</div><div class="line">    <span class="keyword">private</span> CircleIndicatorView mCircleIndicatorView;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonViewPager</span><span class="params">(@NonNull Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonViewPager</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonViewPager</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, @AttrRes <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequiresApi</span>(api = Build.VERSION_CODES.LOLLIPOP)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonViewPager</span><span class="params">(@NonNull Context context, @Nullable AttributeSet attrs, @AttrRes <span class="keyword">int</span> defStyleAttr, @StyleRes <span class="keyword">int</span> defStyleRes)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr, defStyleRes);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</div><div class="line">        View view = LayoutInflater.from(getContext()).inflate(R.layout.common_view_pager_layout,<span class="keyword">this</span>,<span class="keyword">true</span>);</div><div class="line">        mViewPager = (ViewPager) view.findViewById(R.id.common_view_pager);</div><div class="line">        mCircleIndicatorView = (CircleIndicatorView) view.findViewById(R.id.common_view_pager_indicator_view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 设置数据</div><div class="line">     * <span class="doctag">@param</span> data</div><div class="line">     * <span class="doctag">@param</span> creator</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setPages</span><span class="params">(List&lt;T&gt; data, ViewPagerHolderCreator creator)</span></span>&#123;</div><div class="line">        mAdapter = <span class="keyword">new</span> CommonViewPagerAdapter(data,creator);</div><div class="line">        mViewPager.setAdapter(mAdapter);</div><div class="line">        mAdapter.notifyDataSetChanged();</div><div class="line">        mCircleIndicatorView.setUpWithViewPager(mViewPager);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setCurrentItem</span><span class="params">(<span class="keyword">int</span> currentItem)</span></span>&#123;</div><div class="line">        mViewPager.setCurrentItem(currentItem);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">getCurrentItem</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="function"><span class="keyword">return</span> mViewPager.<span class="title">getCurrentItem</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setOffscreenPageLimit</span><span class="params">(<span class="keyword">int</span> limit)</span></span>&#123;</div><div class="line">        mViewPager.setOffscreenPageLimit(limit);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 设置切换动画，see &#123;<span class="doctag">@link</span> ViewPager#setPageTransformer(boolean, ViewPager.PageTransformer)&#125;</div><div class="line">     * <span class="doctag">@param</span> reverseDrawingOrder</div><div class="line">     * <span class="doctag">@param</span> transformer</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setPageTransformer</span><span class="params">(<span class="keyword">boolean</span> reverseDrawingOrder, ViewPager.PageTransformer transformer)</span></span>&#123;</div><div class="line">        mViewPager.setPageTransformer(reverseDrawingOrder,transformer);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * see &#123;<span class="doctag">@link</span> ViewPager#setPageTransformer(boolean, ViewPager.PageTransformer)&#125;</div><div class="line">     * <span class="doctag">@param</span> reverseDrawingOrder</div><div class="line">     * <span class="doctag">@param</span> transformer</div><div class="line">     * <span class="doctag">@param</span> pageLayerType</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setPageTransformer</span><span class="params">(<span class="keyword">boolean</span> reverseDrawingOrder, ViewPager.PageTransformer transformer,</span></span></div><div class="line">                                   <span class="keyword">int</span> pageLayerType) &#123;</div><div class="line">        mViewPager.setPageTransformer(reverseDrawingOrder,transformer,pageLayerType);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * see &#123;<span class="doctag">@link</span> ViewPager#addOnPageChangeListener(ViewPager.OnPageChangeListener)&#125;</div><div class="line">     * <span class="doctag">@param</span> listener</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">addOnPageChangeListener</span><span class="params">(ViewPager.OnPageChangeListener listener)</span></span>&#123;</div><div class="line">        mViewPager.addOnPageChangeListener(listener);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 设置是否显示Indicator</div><div class="line">     * <span class="doctag">@param</span> visible</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">setIndicatorVisible</span><span class="params">(<span class="keyword">boolean</span> visible)</span></span>&#123;</div><div class="line">        <span class="keyword">if</span>(visible)&#123;</div><div class="line">            mCircleIndicatorView.setVisibility(VISIBLE);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            mCircleIndicatorView.setVisibility(GONE);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function">ViewPager <span class="title">getViewPager</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mViewPager;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>CommonViewPager 是对ViewPager的包装，提供了一些ViewPager的常用方法。 其中有一个非常重要的方法public void setPages(List<t> data, ViewPagerHolderCreator creator),提供数据和ViewHolder。其他的基本上都是ViewPager的方法。也可以通过getViewPager 获取到ViewPager 再调用ViewPager的方法。</t></p>
</blockquote>
<p>到此封装也就全部完成了。</p>
<h2 id="CommonViewPager-简便使用"><a href="#CommonViewPager-简便使用" class="headerlink" title="CommonViewPager 简便使用"></a>CommonViewPager 简便使用</h2><p>啰嗦了这么久的封装，那么用起来方便不呢？看一下就知道。<br>1.activity 布局文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.zhouwei.commonviewpager.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">com.zhouwei.viewpagerlib.CommonViewPager</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/activity_common_view_pager"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ViewPager Item 的布局文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">              <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">              <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">              <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">   <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">       <span class="attr">android:id</span>=<span class="string">"@+id/viewPager_item_image"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span>/&gt;</div><div class="line"></div><div class="line">   <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">       <span class="attr">android:id</span>=<span class="string">"@+id/item_desc"</span></div><div class="line">       <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">       <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">       <span class="attr">android:textSize</span>=<span class="string">"15sp"</span></div><div class="line">       <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">       <span class="attr">android:layout_centerInParent</span>=<span class="string">"true"</span></div><div class="line">       <span class="attr">android:textColor</span>=<span class="string">"@android:color/white"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>Activity 代码:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">    mCommonViewPager = (CommonViewPager) findViewById(R.id.activity_common_view_pager);</div><div class="line">    <span class="comment">// 设置数据</span></div><div class="line">    mCommonViewPager.setPages(mockData(), <span class="keyword">new</span> ViewPagerHolderCreator&lt;ViewImageHolder&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> ViewImageHolder <span class="title">createViewHolder</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="comment">// 返回ViewPagerHolder</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ViewImageHolder();</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 提供ViewPager展示的ViewHolder</div><div class="line"> * &lt;P&gt;用于提供布局和绑定数据&lt;/P&gt;</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewImageHolder</span> <span class="keyword">implements</span> <span class="title">ViewPagerHolder</span>&lt;<span class="title">DataEntry</span>&gt;</span>&#123;</div><div class="line">    <span class="keyword">private</span> ImageView mImageView;</div><div class="line">    <span class="keyword">private</span> TextView mTextView;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">createView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="comment">// 返回ViewPager 页面展示的布局</span></div><div class="line">        View view = LayoutInflater.from(context).inflate(R.layout.view_pager_item,<span class="keyword">null</span>);</div><div class="line">        mImageView = (ImageView) view.findViewById(R.id.viewPager_item_image);</div><div class="line">        mTextView = (TextView) view.findViewById(R.id.item_desc);</div><div class="line">        <span class="keyword">return</span> view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBind</span><span class="params">(Context context, <span class="keyword">int</span> position, DataEntry data)</span> </span>&#123;</div><div class="line">       <span class="comment">// 数据绑定</span></div><div class="line">       <span class="comment">// 自己绑定数据，灵活度很大 </span></div><div class="line">       mImageView.setImageResource(data.imageResId);</div><div class="line">       mTextView.setText(data.desc);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码逻辑很清晰，也很简单，只需要提供一个ViewHolder,ViewHolder 自己实现，然后调用<code>setPages</code>方法绑定数据就好了。最后上一张效果图：<br><img src="http://ondlsj2sn.bkt.clouddn.com/FtljxRS8tjZbq3ILOL39_xBwmt3s.gif" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本篇文章的这种封装思想不仅仅对于ViewPager,对于其他的展示集合数据的控件同样实用。其实整个封装还是蛮简单的，但是我觉得这种方法值得推广，以后像我们自己写一个扩展性比较强的控件时，就可以用这种方式。如果把这些一个个控件做成独立的通用的组件，那么我们开发的效率要提高很多。</p>
<!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=100% height=86 src="//music.163.com/outchain/player?type=2&id=songid&auto=1&height=66"></iframe> --></div>
    
      <p class="post-copyright">转载文章请链接上原文地址：<a class="post-copyright-link" href="http://dinson.win/2017/06/03/17-06-03/" title="http://dinson.win/2017/06/03/17-06-03/" target="_blank">http://dinson.win/2017/06/03/17-06-03/</a></p>

      
      <div class="toc-wrapper">
        <div class="toc-scroll">
          <div class="toc-middle">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#概述"><span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#现状"><span class="toc-text">现状</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#封装通用的ViewPager"><span class="toc-text">封装通用的ViewPager</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步：定义一个ViewHolder接口来提供布局和绑定数据：ViewPagerHolder代码如下："><span class="toc-text">第一步：定义一个ViewHolder接口来提供布局和绑定数据：ViewPagerHolder代码如下：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二步：-创建一个ViewHolder生成器，用来生成各种ViewHolder"><span class="toc-text">第二步： 创建一个ViewHolder生成器，用来生成各种ViewHolder:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步：-重写-ViewPager-的Adapter："><span class="toc-text">第三步： 重写 ViewPager 的Adapter：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第四部：包装ViewPager"><span class="toc-text">第四部：包装ViewPager</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CommonViewPager-简便使用"><span class="toc-text">CommonViewPager 简便使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
          </div>
        </div>
      </div>
    
  
  
 
</article>

      <footer class="footer">
  <p class="footer-text">© 2016 - 2017 ❤ Powered by - DINSON</p>
   
  <span id="busuanzi_container_site_pv"><i class="iconfont icon-dianji"></i>&nbsp;&nbsp;<span id="busuanzi_value_site_pv"></span>Times</span>
  <span style="margin: 0.5em 0.5em">|</span>
  <span id="busuanzi_container_site_uv"><i class="iconfont icon-fangke"></i>&nbsp;&nbsp;<span id="busuanzi_value_site_uv"></span>Times</span>
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  <p class="footer-text">一只穿着空气鞋碎花沙滩裤挂着大金链子叼着烟戴着墨镜翘着二郎腿边弹吉他边敲代码的程序猿</p>

  <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

</footer> 
    </article>

    <script src="/js/to-top.js"></script>
    <script src="/js/search.js"></script>
  </body>
</html>
